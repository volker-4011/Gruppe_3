---
title: "Projekt_Variablen"
author: "Peyman Farshidfar"
date: "10 5 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
# Import needed libraries
source("prep_environment.R")
# Import turnover data
options(timeout= 4000000)
umsatzdaten_ferien <- read_csv("https://raw.githubusercontent.com/opencampus-sh/einfuehrung-in-data-science-und-ml/main/umsatzdaten_gekuerzt.csv")
```




```{r html aus einem String entfernen}
cleanFun <- function(htmlString) {
  return(gsub("<.*?>", "", htmlString))
}
```




```{r Daten aus einer Kalender Webseite Teil 1, Alle Jahre im Datensatz ermitteln}

#Herausfiltern aller Jahre im Datensatz:

#Nur das Jahr mit substr(x, start, stop)
#substr(umsatzdaten$Datum, start, stop)
#z.B. 2013-07-01  
#     12345678910
#substr(umsatzdaten$Datum, 1, 4)
allYears <- unique(substr(umsatzdaten_ferien$Datum, 1, 4))


#print(allYears)
#Ausgabe: [1] "2013" "2014" "2015" "2016" "2017" "2018" "2019"

```


```{r Ferien}
ferientage <- data.frame(matrix(ncol = 2, nrow = 0))
for(l in allYears){
  
site = paste("https://www.ferienkalender.com/ferien_deutschland/Schleswig-Holstein/",l,"-ferien-schleswig-holstein.htm", sep = "")
test = read_html(site)

test <- test %>% 
  html_nodes(".kasten") %>%
  html_text() %>% 
  .[1]

test = str_replace_all(test,"\n", "") 
test = str_replace_all(test, paste("Ferienkalender Schleswig-Holstein ",l,"Ferien ",l," im deutschen Bundesland Schleswig-Holstein:Winterferien-", sep = ""), "")



test = str_replace_all(test," / Frühjahrsferien", "") 


test = str_replace_all(test, paste("Ferien ",l," für Schleswig-Holstein", sep = ""), "") 



#######################################
test = str_replace_all(test," - ", "0000") 
numbers <- str_extract_all(test,"\\(?[0-9,.]+\\)?")[[1]]
numbers <- paste(numbers, l, sep="")
numbers = str_replace_all(numbers,"0000", paste(l," Y ", sep = ""))



year_add <- as.numeric(as.numeric(l)+1)

#######################################


#######################################
characters <- str_extract_all(test,"\\(?[a-zA-Z]+\\)?")[[1]] 


print(characters)

length(numbers)
#######################################


k = 1;
m = 1;

for (j in numbers){
date <- j 


if(m==5){
  date = str_sub(date,end = -5)
  date = paste(date, year_add, sep = "")
}



date <- strsplit(date, split = " Y ") 







date <-unlist(date, use.names=FALSE);
print(date) 






date <- as.Date(date, "%d.%m.%Y")  
print(date) 


name <- characters[k]
print(name) 




if(length(date) > 1){
#date <- seq(as.Date(date[1]), as.Date(date[2]), by="days")
date <- as.Date(as.Date(date[1]):as.Date(date[2]), origin="1970-01-01")
}




ferientage <- rbind(ferientage,data.frame(date,name))

k = k + 1;
m = m + 1;  
}


}
```







```{r Alle Variablen leeren}
remove(allYears,characters,date,j,k,l,m,name,numbers,site,test,year_add,umsatzdaten_ferien)
```


